<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using own classifications • regstudies</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using own classifications">
<meta property="og:description" content="regstudies">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">regstudies</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/using_own_classifications.html">Using own classifications</a>
    </li>
    <li>
      <a href="../articles/data_wrangling.html">Data wrangling for register studies</a>
    </li>
    <li>
      <a href="../articles/classification_tables.html">Classification tables</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pohjois-savon-tietoallas/regstudies/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using own classifications</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pohjois-savon-tietoallas/regstudies/blob/master/vignettes/using_own_classifications.Rmd"><code>vignettes/using_own_classifications.Rmd</code></a></small>
      <div class="hidden name"><code>using_own_classifications.Rmd</code></div>

    </div>

    
    
<div id="classifications" class="section level2">
<h2 class="hasAnchor">
<a href="#classifications" class="anchor"></a>Classifications</h2>
<div id="code-classification-by-own-csv-table" class="section level3">
<h3 class="hasAnchor">
<a href="#code-classification-by-own-csv-table" class="anchor"></a>Code classification by own csv table</h3>
<p>The package has been built in mind of allowing user to use their own classifications for ICD codes (or any string codes). The classifications can utilise multiple different types of codes. For example, below we use ICD-10 and ICD-9 codes on a single classification definition. The classification definition need to hold following variable names: <code>class_X</code> and <code>label_X</code>, where X is the name of class defintion and also at least one other column what defines the regular expression for the class. The regular expression describes all the codes that belong to the same class. For example in our example data set, the first group is called “aids” and regular expression for <code>icd10</code> column is <code>"^B20|^B21|^B22|^B24"</code>. This means that all the codes starting with either B20, B21, B22 or B24, which are labeled as <code>"icd10"</code> by another variable <code>icd</code> (TODO: codetype) in the data, belong to this class. The symbol “^” states that the codes must begin with these characters. The symbol “|” is OR operator in regular expression syntax. For more information about regular expression, please read <a href="https://rstudio.com/wp-content/uploads/2016/09/RegExCheatsheet.pdf">Regular Expression Cheat Sheet</a>.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">regstudies</span>)
<span class="co"># ´regstudies´ makes it easy to classify codes such as ICD-codes to groups and also to sum scores based on the groupings.</span>
<span class="no">sample_data</span> <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">sample_cohort</span>,<span class="no">sample_regdata</span>)
<span class="no">sample_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/classify_charlson.html">classify_charlson</a></span>(<span class="kw">icd_codes</span> <span class="kw">=</span> <span class="no">CODE1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/sum_score.html">sum_score</a></span>(<span class="no">score_charlson</span>)

<span class="co"># Users can define the code groups themselves using simple regular expression syntax.</span>
<span class="no">my_classes</span> <span class="kw">&lt;-</span>
  <span class="fu">tribble</span>(~<span class="no">class_myclass</span>,         ~<span class="no">label_myclass</span>,                                 ~<span class="no">icd10</span>,                 ~<span class="no">icd9</span>, ~<span class="no">score</span>,
                  <span class="st">"aids"</span>,          <span class="st">"AIDS or HIV"</span>,                  <span class="st">"^B20|^B21|^B22|^B24"</span>,      <span class="st">"^042|^043|^044"</span>,      <span class="fl">7</span>,
              <span class="st">"dementia"</span>,             <span class="st">"Dementia"</span>, <span class="st">"^F00|^F01|^F02|^F03|^F051|^G30|^G311"</span>,    <span class="st">"^290|^2941|^3312"</span>,      <span class="fl">3</span>,
                   <span class="st">"pud"</span>, <span class="st">"Peptic ulcer disease"</span>,                  <span class="st">"^K25|^K26|^K27|^K28"</span>, <span class="st">"^531|^532|^533|^534"</span>,      <span class="fl">1</span>
          )

<span class="co"># This classification definition has two different type of codes.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">my_classes</span>)

<span class="co"># Data has three different types of codes.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sample_data</span>)

<span class="co"># Different groups types can are automatically handled simultaneously.</span>
<span class="no">sample_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/classify_codes.html">classify_codes</a></span>(<span class="kw">codes</span><span class="kw">=</span><span class="no">CODE1</span>,<span class="kw">diag_tbl</span> <span class="kw">=</span> <span class="fu"><a href="../reference/read_classes.html">read_classes</a></span>(<span class="no">my_classes</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/sum_score.html">sum_score</a></span>(<span class="no">score</span>)</pre></body></html></div>
</div>
<div id="elixhauser-classification-and-scores" class="section level3">
<h3 class="hasAnchor">
<a href="#elixhauser-classification-and-scores" class="anchor"></a>Elixhauser classification and scores</h3>
<p>This calculates per row Elixhauser classification. Check more info of classification from <a href="docs/articles/classification_tables.html">classification tables</a>-section.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Classify by Elixhauser:</span>
<span class="no">my_classes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/read_classes.html">read_classes</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="st">"../data/elixhauser_classes.csv"</span>)

<span class="no">classified_d</span> <span class="kw">&lt;-</span> <span class="no">filtered_d</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/classify_codes.html">classify_codes</a></span>(<span class="kw">codes</span> <span class="kw">=</span> <span class="no">CODE1</span>,
                 <span class="kw">diag_tbl</span> <span class="kw">=</span> <span class="no">my_classes</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">classified_d</span>)</pre></body></html></div>
<p>Another way (a shortcut) for Elixhauser classifications:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">elixh_d</span> <span class="kw">&lt;-</span> <span class="no">filtered_d</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/classify_elixhauser.html">classify_elixhauser</a></span>(<span class="kw">icd_codes</span> <span class="kw">=</span> <span class="no">CODE1</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">elixh_d</span>)</pre></body></html></div>
<p>To calculate the scores of Elixhauser comorbidity index, we can use <code>sum_score</code> function. As our classification table defines two alternative score definitions, namely <code>score_AHRQ</code> and <code>score_van_Walraven</code>, we can calculate both of them on one call as follows:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">elixh_score</span> <span class="kw">&lt;-</span> <span class="no">filtered_d</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/classify_elixhauser.html">classify_elixhauser</a></span>(<span class="kw">icd_codes</span> <span class="kw">=</span> <span class="no">CODE1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/sum_score.html">sum_score</a></span>(<span class="no">score_AHRQ</span>, <span class="no">score_van_Walraven</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">elixh_score</span>)</pre></body></html></div>
</div>
<div id="charlson-classification-and-scores" class="section level3">
<h3 class="hasAnchor">
<a href="#charlson-classification-and-scores" class="anchor"></a>Charlson classification and scores</h3>
<p>We also provide Charlson comorbidity classification ready to use in <code>regstudies</code>. It can be easilly used with function <code>classify_charlson</code>. The use of <code>classify_charlson</code> is very identical to use of <code>classify_elixhauser</code>. Only difference is that in the classification the score-variable is called <code>score_charlson</code>.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co">## Classifying Charlson comorbidity classes to long format</span>

<span class="no">charlson_score</span> <span class="kw">&lt;-</span> <span class="no">filtered_d</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/classify_charlson.html">classify_charlson</a></span>(<span class="kw">icd_codes</span> <span class="kw">=</span> <span class="no">CODE1</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/sum_score.html">sum_score</a></span>(<span class="no">score_charlson</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">charlson_score</span>)</pre></body></html></div>
</div>
<div id="long-data-to-wide-data" class="section level3">
<h3 class="hasAnchor">
<a href="#long-data-to-wide-data" class="anchor"></a>Long data to wide data</h3>
<p>The outputs of all classification functions (<code>classify_elixhauser</code>, <code>classify_charlson</code> and <code>classify_codes</code>) gives output as long data. If user need to have class indicators or scores of each events as wide, it can be accomplished using <code>pivot_wider</code> as follows.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">charlson_d</span> <span class="kw">&lt;-</span> <span class="no">filtered_d</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/classify_charlson.html">classify_charlson</a></span>(<span class="kw">icd_codes</span> <span class="kw">=</span> <span class="no">CODE1</span>)

<span class="no">charlson_d</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">class_charlson</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"cl_"</span>,<span class="no">class_charlson</span>)) <span class="kw">%&gt;%</span> <span class="co"># TODO: laita tämä ominaisuus classify-funktioon sisälle!</span>
  <span class="fu">mutate</span>(<span class="kw">score_charlson</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="no">score_charlson</span><span class="kw">&gt;</span><span class="fl">0</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">tidyr</span><span class="kw ns">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(<span class="kw">names_from</span><span class="kw">=</span><span class="st">"class_charlson"</span>,
                     <span class="kw">values_from</span><span class="kw">=</span><span class="st">"score_charlson"</span>,
                     <span class="kw">values_fill</span><span class="kw">=</span><span class="fl">0</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="fu">all_of</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cl_NA"</span>,<span class="st">"label_charlson"</span>))) <span class="kw">-&gt;</span> <span class="no">wide</span> <span class="co"># Some events do not belong to any class. That creates NA to data and pivot_wider handles NA classes to cl_NA column in this code.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">wide</span>)</pre></body></html></div>
</div>
<div id="some-extra-labeling-wide-data" class="section level3">
<h3 class="hasAnchor">
<a href="#some-extra-labeling-wide-data" class="anchor"></a>Some extra: labeling wide data</h3>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co">## calculating labels</span>
<span class="kw pkg">regstudies</span><span class="kw ns">:::</span><span class="no">charlson_classes</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">class_charlson</span>,<span class="no">label_charlson</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">class_charlson</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"cl_"</span>,<span class="no">class_charlson</span>)) <span class="kw">-&gt;</span> <span class="no">labels</span>

<span class="co"># setting up the labels for wide data</span>
<span class="kw">for</span>(<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">labels</span>)[<span class="fl">1</span>]) {
  <span class="no">l</span><span class="kw">&lt;-</span><span class="no">labels</span>$<span class="no">class_charlson</span>[<span class="no">i</span>]
  <span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">wide</span><span class="kw">[[</span><span class="no">l</span>]])) {
    <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="no">wide</span><span class="kw">[[</span><span class="no">l</span>]], <span class="st">"label"</span>) <span class="kw">&lt;-</span> <span class="no">labels</span>$<span class="no">label_charlson</span>[<span class="no">i</span>]
  }
}
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">wide</span>)</pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Juho Kopra, Jani Miettinen, Reijo Sund.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
